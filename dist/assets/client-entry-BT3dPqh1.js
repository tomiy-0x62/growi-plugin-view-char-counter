const f="growi-plugin-view-char-counter",l="growi-view-char-counter";let s=null;const d=[],g=(e,t)=>{if(!t)return!1;let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1},u=e=>{if(e.querySelector(`.${l}`))return;const t=document.createElement("div");t.className=l,Object.assign(t.style,{fontSize:"12px",opacity:"0.7",padding:"4px 8px",marginTop:"8px",textAlign:"right",borderTop:"1px solid rgba(0,0,0,0.1)"}),e.appendChild(t);const n=i=>i.length,r=()=>{const i=e.textContent??"",c=window.getSelection();let a="";if(c&&c.rangeCount>0){const p=c.getRangeAt(0);g(e,p.commonAncestorContainer)&&(a=c.toString())}a.length>0?t.textContent=`選択中: ${n(a)} 文字 / ページ全体: ${n(i)} 文字`:t.textContent=`ページ全体: ${n(i)} 文字`},o=()=>r();e.addEventListener("keyup",o),e.addEventListener("mouseup",o),document.addEventListener("selectionchange",o),r(),d.push(()=>{e.removeEventListener("keyup",o),e.removeEventListener("mouseup",o),document.removeEventListener("selectionchange",o),t.remove()})},m=()=>{const e=['[data-testid="page-content"]',".wiki",".page-content",".content-main"];for(const t of e){const n=Array.from(document.querySelectorAll(t));if(n.length>0)return n}return[]},v=()=>{m().forEach(t=>u(t)),s=new MutationObserver(t=>{for(const n of t)n.addedNodes.forEach(r=>{var o;r instanceof Element&&(r.matches('[data-testid="page-content"], .wiki, .page-content, .content-main')&&u(r),(o=r.querySelectorAll)==null||o.call(r,'[data-testid="page-content"], .wiki, .page-content, .content-main').forEach(i=>u(i)))})}),s.observe(document.body,{childList:!0,subtree:!0})},h=()=>{typeof window>"u"||typeof document>"u"||v()},w=()=>{s&&(s.disconnect(),s=null),d.splice(0).forEach(e=>e())};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[f]={activate:h,deactivate:w};
