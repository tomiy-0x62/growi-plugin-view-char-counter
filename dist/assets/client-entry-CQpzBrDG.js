const p="growi-plugin-view-char-counter",l="growi-view-char-counter-floating";let s=null;const u=[];let r=[];const g=(e,n)=>{if(!n)return!1;let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1},d=()=>{const e=['[data-testid="page-content"]',".wiki",".page-content",".content-main"];for(const n of e){const t=Array.from(document.querySelectorAll(n));if(t.length>0)return t}return[]},m=()=>{let e=document.getElementById(l);return e||(e=document.createElement("div"),e.id=l,Object.assign(e.style,{position:"fixed",right:"12px",bottom:"12px",zIndex:"9999",fontSize:"12px",opacity:"0.8",padding:"6px 10px",borderRadius:"4px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"#fff",pointerEvents:"none",maxWidth:"50vw",textAlign:"right",whiteSpace:"nowrap"}),document.body.appendChild(e),u.push(()=>{e==null||e.remove()})),e},i=()=>{const e=m();if(r.length===0&&(r=d()),r.length===0){e.textContent="ページ全体: 0 文字";return}const n=r.map(c=>c.textContent??"").join(`
`),t=c=>c.length,o=window.getSelection();let a="";if(o&&o.rangeCount>0){const c=o.getRangeAt(0);r.some(f=>g(f,c.commonAncestorContainer))&&(a=o.toString())}a.length>0?e.textContent=`選択中: ${t(a)} 文字 / ページ全体: ${t(n)} 文字`:e.textContent=`ページ全体: ${t(n)} 文字`},v=()=>{r=d(),i(),s=new MutationObserver(e=>{let n=!1;for(const t of e)t.addedNodes.forEach(o=>{o instanceof Element&&(o.matches('[data-testid="page-content"], .wiki, .page-content, .content-main')||o.querySelector('[data-testid="page-content"], .wiki, .page-content, .content-main'))&&(n=!0)});n&&(r=d(),i())}),s.observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("keyup",i),document.addEventListener("mouseup",i),document.addEventListener("selectionchange",i),u.push(()=>{document.removeEventListener("keyup",i),document.removeEventListener("mouseup",i),document.removeEventListener("selectionchange",i)})},h=()=>{typeof window>"u"||typeof document>"u"||v()},w=()=>{s&&(s.disconnect(),s=null),u.splice(0).forEach(e=>e())};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[p]={activate:h,deactivate:w};
