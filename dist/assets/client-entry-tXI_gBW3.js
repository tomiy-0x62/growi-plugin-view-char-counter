const f="growi-plugin-view-char-counter",d="growi-view-char-counter";let c=null;const a=[];let r=[];const g=(e,t)=>{if(!t)return!1;let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1},l=()=>{const e=['[data-testid="page-content"]',".wiki",".page-content",".content-main"];for(const t of e){const n=Array.from(document.querySelectorAll(t));if(n.length>0)return n}return[]},p=()=>{const e=["div.SystemVersion_system-version__ygB5P",".SystemVersion_system-version__ygB5P"];for(const t of e){const n=document.querySelector(t);if(n)return n}return null},v=()=>{let e=document.getElementById(d);if(e)return e;const t=p();return!t||!t.parentElement?null:(e=document.createElement("span"),e.id=d,Object.assign(e.style,{fontSize:"11px",opacity:"0.8",marginRight:"8px",whiteSpace:"nowrap"}),t.parentElement.insertBefore(e,t),a.push(()=>{e==null||e.remove()}),e)},s=()=>{r.length===0&&(r=l());const e=v();if(!e)return;if(r.length===0){e.textContent="ページ全体: 0 文字";return}const t=r.map(i=>i.textContent??"").join(`
`),n=i=>i.length,o=window.getSelection();let u="";if(o&&o.rangeCount>0){const i=o.getRangeAt(0);r.some(m=>g(m,i.commonAncestorContainer))&&(u=o.toString())}u.length>0?e.textContent=`選択中: ${n(u)} 文字 / ページ全体: ${n(t)} 文字`:e.textContent=`ページ全体: ${n(t)} 文字`},y=()=>{r=l(),s(),c=new MutationObserver(e=>{let t=!1;for(const n of e)n.addedNodes.forEach(o=>{o instanceof Element&&(o.matches('[data-testid="page-content"], .wiki, .page-content, .content-main')||o.querySelector('[data-testid="page-content"], .wiki, .page-content, .content-main')||o.matches("div.SystemVersion_system-version__ygB5P")||o.querySelector("div.SystemVersion_system-version__ygB5P"))&&(t=!0)});t&&(r=l(),s())}),c.observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("keyup",s),document.addEventListener("mouseup",s),document.addEventListener("selectionchange",s),a.push(()=>{document.removeEventListener("keyup",s),document.removeEventListener("mouseup",s),document.removeEventListener("selectionchange",s)})},w=()=>{typeof window>"u"||typeof document>"u"||y()},h=()=>{c&&(c.disconnect(),c=null),a.splice(0).forEach(e=>e())};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators[f]={activate:w,deactivate:h};
